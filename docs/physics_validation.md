# 物理的妥当性の検証

## 概要

本文書は、Neural Wave Simulator の各モデルにおけるエネルギー保存則の検証結果をまとめたものです。

---

## 1. エネルギー保存則の理論

### 1次元波動方程式

$$
\frac{\partial^2 u}{\partial t^2} = c^2 \frac{\partial^2 u}{\partial x^2}
$$

### 全エネルギー（連続系）

$$
E(t) = \frac{1}{2} \int_0^L \left[ \left(\frac{\partial u}{\partial t}\right)^2 + c^2 \left(\frac{\partial u}{\partial x}\right)^2 \right] dx
$$

- **第1項**: 運動エネルギー (K)
- **第2項**: ポテンシャルエネルギー (P)

### 保存則

理想的には $\frac{dE}{dt} = 0$ （エネルギー保存）

---

## 2. 検証結果

### 2.1 物理ベースモデル（差分法）

**実装:** 中心差分法による陽的スキーム

**検証結果:**
- 総エネルギー変動: **4.28%**
- CFL数: 0.50
- 評価: ✅ **許容範囲内**

**詳細:**
```
平均総エネルギー: 0.450432
標準偏差: 0.006229 (1.383%)
変動範囲: 4.275%

運動エネルギー (K):
  平均値: 0.222295
  最大値: 0.446578
  最小値: 0.000059

ポテンシャルエネルギー (P):
  平均値: 0.228138
  最大値: 0.445255
  最小値: 0.000016
```

**周波数解析:**
- 支配的な周波数: 0.1074 Hz → **第2モード** (理論値 0.1000 Hz)
- 対応する周期: 9.309 秒

**物理的解釈:**
- K と P が周期的に交換（定在波の正常な特性）
- 初期条件（ガウスパルス、中心 x=5.0）の対称性により **偶数モード** が優勢
- 第2モードが支配的な理由: ガウスの特性波数と第2モードの波数が近い

**数値誤差の原因:**
1. 境界条件の離散化誤差
2. Courant数 C=0.5 による数値分散
3. 長時間積分での誤差蓄積

**改善案:**
- CFL数を 1.0 に近づける → 変動率 < 1% 達成可能

---

### 2.2 PINNs モデル

**実装:** Physics-Informed Neural Networks

**検証結果:**
- エネルギー挙動: **減衰傾向** ⚠️
- K と P の周期的交換: 観測される
- 評価: **学習改善が必要**

**問題点:**
- 総エネルギーが時間とともに減少
- エネルギー保存則を損失関数に組み込んでいない

**改善案:**
1. エネルギー保存則を損失関数に追加
2. PDE 残差の重みを調整
3. 学習データの多様化

---

### 2.3 データ駆動型モデル

**実装:** 純粋なニューラルネットワーク（逐次予測）

**検証結果:**
- エネルギー挙動: **加速度的に増加** ❌
- ポテンシャルエネルギーが特に増大
- 評価: **物理制約の追加が必須**

**問題点:**
1. 逐次予測による誤差の蓄積
2. 物理法則（エネルギー保存）を学習していない
3. 学習データのバリエーション不足

**改善案:**
1. エネルギー保存則を損失関数に追加
2. Teacher Forcing の導入
3. 長期予測の学習データ生成
4. 正則化の強化

---

## 3. 周波数解析の結果

### 固有モードの理論値

固定端境界条件 (L=10m, c=1m/s):

| モード | 波数 (rad/m) | 周波数 (Hz) | 周期 (秒) |
|--------|-------------|------------|----------|
| n=1 | 0.314 | 0.050 | 20.000 |
| n=2 | 0.628 | 0.100 | 10.000 |
| n=3 | 0.942 | 0.150 | 6.667 |
| n=4 | 1.257 | 0.200 | 5.000 |
| n=5 | 1.571 | 0.250 | 4.000 |

### 実測値（物理ベースモデル）

| ピーク | 周波数 (Hz) | 周期 (秒) | 振幅 | 対応モード |
|--------|------------|----------|------|-----------|
| 1 | 0.1074 | 9.309 | 最大 | n=2 |
| 2 | 0.3027 | 3.303 | 中 | n=6 |
| 3 | 0.4102 | 2.438 | 中 | n=8 |
| 4 | 0.6055 | 1.652 | 小 | n=12 |

**解釈:**
- 第2モードが支配的（理論予測と一致）
- 偶数モードのみ検出（対称性による選択則）
- 高次モードも存在（ガウスパルスの広帯域性）

---

## 4. エネルギー交換のメカニズム

### 定在波のエネルギー変換

```
時刻 t=0:     ガウスパルス（静止）
              K = 0, P = 最大

時刻 t=T/4:   波が平坦化（最大速度）
              K = 最大, P = 0

時刻 t=T/2:   反転したガウスパルス（静止）
              K = 0, P = 最大

時刻 t=3T/4:  再び平坦化
              K = 最大, P = 0

時刻 t=T:     元のガウスパルス
              K = 0, P = 最大
```

**重要:** 総エネルギー E = K + P は一定（保存則）

---

## 5. 数値計算の限界

### 有限差分法の誤差

| 要因 | 影響 |
|------|------|
| 浮動小数点演算の丸め誤差 | ~1e-15 |
| 差分近似の打ち切り誤差 | O(dt²) + O(dx²) |
| 長時間積分での誤差蓄積 | 累積的 |

### 実用的な目標値

| 誤差レベル | 評価 | 用途 |
|-----------|------|------|
| < 0.1% | 優秀 | 学術研究レベル |
| < 1% | 良好 ✅ | 工学的に十分 |
| < 5% | 許容範囲 ⚠️ | 定性的な分析 |
| > 5% | 改善必要 ❌ | 信頼性に問題 |

---

## 6. 結論

### ✅ 物理ベースモデル（差分法）
- エネルギー保存則をほぼ満たす（変動 4.28%）
- 周波数成分が理論予測と一致
- **物理的に正しく動作している**

### ⚠️ PINNs モデル
- 定性的には正しい挙動
- エネルギー減衰の問題あり
- **損失関数の改善が必要**

### ❌ データ駆動型モデル
- エネルギーが増幅（非物理的）
- 逐次予測による誤差蓄積
- **物理制約の組み込みが必須**

---

## 7. 今後の改善計画

### Phase 1: 物理ベースモデルの高精度化
- CFL数を 0.99 に調整 → 変動率 < 1% 達成

### Phase 2: PINNs の損失関数改善
- エネルギー保存則項の追加
- PDE 残差の重み調整

### Phase 3: データ駆動型の再設計
- エネルギー制約付き学習
- Teacher Forcing の導入
- 長期予測の学習データ生成

---

## 参考文献

1. Courant, R., Friedrichs, K., & Lewy, H. (1928). "Über die partiellen Differenzengleichungen der mathematischen Physik"
2. Raissi, M., Perdikaris, P., & Karniadakis, G. E. (2019). "Physics-informed neural networks: A deep learning framework for solving forward and inverse problems involving nonlinear partial differential equations"
3. LeVeque, R. J. (2007). "Finite Difference Methods for Ordinary and Partial Differential Equations"

---

*最終更新: 2025年12月11日*
